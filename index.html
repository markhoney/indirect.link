<!doctype html>
<html lang="en" class="h-100">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Indirect Link</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
		<script type="text/javascript" src="/basex.js"></script>
		<script type="text/javascript" src="/indirect.link/basex.js"></script>
		<script type="module">
			import {createApp} from 'https://unpkg.com/petite-vue?module';
			createApp({
				url: '',
				obscure: true,
				redirect: false,
				warning: true,
				invalid: '_',
				get path() {
					let url;
					try {
						url = new URL(this.url);
					} catch (e) {
						try {
							url = new URL('https://' + this.url);
						} catch (e) {
							return null;
						}
					}
					if (this.obscure) {
						url = convert(url.toString(), dict[85], dict[64]);
					} else {
						const split = url.host.split('.');
						let longest = 0;
						let index = null;
						for (const [i, value] of split.entries()) {
							if (value.length >= longest) {
								longest = value.length;
								index = i;
							}
						}
						const middle = Math.ceil(split[index].length / 2);
						split[index] = split[index].slice(0, middle) + this.invalid + split[index].slice(middle);
						url.host = split.join('.');
						url = url.toString();
					}
					if (this.redirect) url = 'r/' + url;
					if (url) return '/' + url;
				},
				get link() {
					if (this.path) return window.location.host + this.path;
				},
				mounted() {
					new bootstrap.Tooltip(this.$refs.copy);
				},
			}).mount();
		</script>
	</head>
	<body class="d-flex flex-column h-100">
		<header class="p-3 text-center bg-dark text-light">
			<nav class="navbar navbar-expand-md text-center"><!-- fixed-top -->
				<a class="navbar-brand fs-2 text-reset" href="/">Indirect Link</a>
			</nav>
		</header>
		<main class="flex-shrink-0">
			<section class="container text-center mt-5">
				<label for="url" class="form-label fs-3">Enter your blacklisted URL here</label>
				<input type="text" id="url" v-model="url" class="w-100 form-control form-control-lg fs-2" placeholder="e.g. https://naturalnews.com/">
				<div class="text-left">
					<div class="form-check form-switch">
						<input type="checkbox" id="obscure" v-model="obscure" class="form-check-input">
						<label for="obscure" class="form-check-label">Obscure URL</label>
					</div>
					<div class="form-check form-switch">
						<input type="checkbox" id="redirect" v-model="redirect" class="form-check-input">
						<label for="redirect" class="form-check-label">Automatic Redirect</label>
					</div>
				</div>
				<div v-if="link">
					<p class="fs-3 mt-5 text-center">Use this safe URL in your social media posts</p>
					<p class="fs-1" style="word-wrap: break-word">
						<a v-if="link" :href="path" rel="nofollow noopener noreferrer">{{link}}</a>
					</p>
					<p>
						<i
							ref="copy"
							class="bi-clipboard-plus fs-3"
							style="cursor: copy"
							data-bs-toggle="tooltip"
							data-bs-placement="right"
							title="Copy to clipboard"
							@click="navigator.clipboard.writeText(link)"
						></i>
					</p>
				</div>
				<p v-else-if="warning && link?.length" class="fs-1 text-danger">Please enter a valid URL</p>
			</section>
		</main>
		<footer class="footer mt-auto py-3 text-center bg-dark text-light">
			<p>Copyright 2022 <a href="https://skeptics.nz" target="_blank" class="text-reset">NZ Skeptics</a></p>
		</footer>
	</body>
</html>
