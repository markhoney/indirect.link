<!doctype html>
<html lang="en" class="h-100">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Weak Link</title>
		<meta property="og:site_name" content="Weak Link">
		<meta property="og:title" content="Warning: Potential Misinformation">
		<meta property="og:description" name="description" content="Caution: The website you are about to be linked to likely contains misinformation. It has been obfuscated to allow sharing of dubious content on social media by skeptical groups">
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://weak.link">
		<meta property="og:image" content="https://weak.link/logo.jpg">
		<meta name="twitter:card" content="summary_large_image">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="theme-color" content="#ffffff">
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-0KGEQRSSN6"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-0KGEQRSSN6');
		</script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
		<script type="text/javascript" src="/basex.js"></script>
		<script type="module">
			import {createApp} from 'https://unpkg.com/petite-vue?module';
			createApp({
				site: window.location.pathname.slice(1).replace('weak.link/', ''),
				referrer: document.referrer,
				referrers: [
					'http://localhost',
					'https://weak.link',
					'https://www.facebook.com/nzskeptics',
					'https://www.facebook.com/groups/nzskeptics',
					'https://www.facebook.com/groups/nzskepticsclosedgroup',
					'https://www.facebook.com/groups/ScienceBasedHealthcare',
					'https://www.facebook.com/groups/rabbitholeresistance',
					'https://www.facebook.com/groups/426054588754056',
					'https://www.facebook.com/groups/rationalistsnz',
					'https://www.facebook.com/HumanistNZ',
				],
				redirect: false,
				get valid() {
					if (!document.referrer) return null;
					if (this.referrers.find((referrer) => document.referrer.startsWith(referrer))) return true;
					return false;
				},
				/* get redirect() {
					const split = this.site.split('/');
					if (split[0] === 'r') {
						return 0;
					} else if (Number.isInteger(Number(split[0]))) {
						return Number(split[0]);
					}
					return null;
				}, */
				get url() {
					if (!this.valid) return;
					const split = this.site.split('/');
					if (split[0] === 'r') {
						this.redirect = 0;
						split.shift();
					} else if (Number.isInteger(Number(split[0]))) {
						this.redirect = Number(split[0]);
						split.shift();
					}
					if (!split[0].includes('.')) return basex.convert(split.join('/'), basex.dict.base85uri, basex.dict.base64url);
					let url;
					try {
						url = new URL(split.join('/'));
					} catch (e) {
						return null;
					}
					url.host = url.host.replace(/[^\-\.abcdefghijklmnopqrstuvwxyz0123456789ßàÁâãóôþüúðæåïçèõöÿýòäœêëìíøùîûñé]/g, '');
					url = url.toString();
					if (this.redirect !== false) {
						setTimeout(() => {
							window.location.replace(url);
						}, redirect * 1000);
					}
					return url;
				},
			}).mount();
		</script>
	</head>
	<body class="d-flex flex-column h-100">
		<header class="p-3 text-center bg-dark text-light">
			<nav class="navbar navbar-expand-md text-center"><!-- fixed-top -->
				<a class="navbar-brand fs-2 text-reset" href="/">Weak Link</a>
			</nav>
		</header>
		<main class="flex-shrink-0">
			<section class="container text-center mt-5">
				<p v-if="valid"><a :href="url" rel="nofollow noopener noreferrer">{{url}}</a></p>
				<p v-else-if="valid === false">Invalid Referrer</p>
				<p v-else>Invalid URL</p>
			</section>
		</main>
		<footer class="footer mt-auto py-3 text-center bg-dark text-light">
			<p>This website was created by the <a href="https://skeptics.nz" target="_blank" rel="noopener" class="text-reset">NZ Skeptics</a></p>
		</footer>
	</body>
</html>
